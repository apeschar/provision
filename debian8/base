#!/bin/bash

set -eu
set -o pipefail

say() { echo "$@" >&2; }
say_do() { say "$@"; "$@"; }

cd /

export DEBIAN_FRONTEND=noninteractive

pkgs=(
    curl
    git
    htop
    moreutils
    mosh
    ncdu
    ntp
    pv
    rsync
    sudo
    sysstat
    ufw
    vim-nox
)

say_do apt-get -qq update
say_do apt-get -qq dist-upgrade -y

say_do apt-get -qq install -y ${pkgs[@]}

say_do ufw allow 22/tcp
say_do ufw allow 60000:60999/udp
say_do ufw --force enable

say_do perl -pi -e 's/^ENABLED="false"/ENABLED="true"/' /etc/default/sysstat
say_do systemctl restart sysstat

say_do apt-get -qq autoremove -y

echo Europe/Amsterdam > /etc/timezone
dpkg-reconfigure tzdata

update-alternatives --set editor /usr/bin/vim.nox

echo -n > /etc/motd
